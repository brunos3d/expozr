# üöÄ Expozr

**Universal plugin ecosystem for dynamic module sharing**

Expozr enables any web bundler to expose and consume modules at runtime, creating a truly decentralized application architecture that's simpler and more flexible than traditional approaches.

> **üöß Current Status**: Expozr is in active development. The core functionality and Webpack adapter are working with examples available. See [examples](./examples) for working demos.

## üéØ Core Concepts

### üè™ **Expozr** (Remote Application)

The application that **exposes** modules. Think of it as a supplier in the ecosystem.

- Contains the actual implementation of shared components/utilities
- Generates an **Inventory** (exposure map)
- Can be deployed independently

### üè† **Host** (Consumer Application)

The application that **consumes** exposed modules from expozrs.

- Loads modules from Expozrs at runtime
- Uses a **Catalog** to discover available modules
- Handles dependency resolution automatically

### üì¶ **Cargo** (Exposed Module)

Individual module/component being shared.

- Can be a React component, utility function, entire library, etc.
- Has metadata: name, version, dependencies, entry point
- Loaded dynamically at runtime

### üìã **Inventory** (Exposure Map)

JSON manifest generated by Expozrs that lists all available Cargo with metadata.

### üß≠ **Navigator** (Runtime Loader)

Universal runtime system that handles dynamic loading, dependency resolution, and caching.

## ‚ú® Key Features

### ÔøΩ **Universal Module System**

- üåç **Bundler Agnostic**: Works with any bundler (Webpack, Vite, Rollup, Rspack, etc.)
- ÔøΩ **Multi-Format Support**: ESM, UMD, CJS, AMD, IIFE, SystemJS with automatic detection
- üß† **Intelligent Fallbacks**: Graceful degradation when preferred formats fail
- ‚ö° **Hybrid Mode**: Load both ESM and UMD versions of the same module

### üöÄ **Runtime Excellence**

- üöÄ **Dynamic Loading**: Load modules at runtime without build-time coupling
- üéØ **Smart Format Detection**: Automatically detects and loads the best available format
- ÔøΩÔ∏è **Error Recovery**: Comprehensive error handling with detailed feedback
- üìä **Format Tracking**: Monitor which formats are successfully loaded

### üîß **Developer Experience**

- üîß **Great DX**: Simple APIs, CLI tools, and comprehensive documentation
- üèóÔ∏è **TypeScript First**: Full type safety with intelligent autocompletion
- üì± **Cross-Platform**: Works seamlessly in Browser and Node.js environments
- üî• **Hot Reloading**: Development-time module reloading support

### ‚öôÔ∏è **Advanced Configuration**

- üîÑ **Version Management**: Semantic versioning with automatic resolution
- üèóÔ∏è **Dependency Resolution**: Smart dependency handling and conflict resolution
- ‚öôÔ∏è **Configuration Presets**: Pre-built configurations for common scenarios
- üõ†Ô∏è **Plugin Architecture**: Extensible system for custom functionality

### üíæ **Intelligent Caching**

- üíæ **Multiple Strategies**: Memory, localStorage, IndexedDB, or no caching
- ‚è±Ô∏è **TTL Support**: Time-based cache invalidation
- ÔøΩ **Cache Analytics**: Monitor cache performance and hit rates
- üîÑ **Smart Invalidation**: Automatic cache updates when modules change

### üîí **Production Ready**

- üõ°Ô∏è **Error Boundaries**: Graceful error handling and recovery
- üìä **Performance Monitoring**: Track loading times and cache efficiency
- ÔøΩ **Debug Mode**: Detailed logging for development and troubleshooting
- üöÄ **Optimized Loading**: Preloading and lazy loading strategies

## üöÄ Quick Start

### 1. Create a Expozr (Expose Modules)

You can either use the CLI (in development) or set up manually:

**Option A: Manual Setup (Recommended)**

```bash
mkdir my-components && cd my-components
npm init -y
npm install @expozr/webpack-adapter webpack webpack-cli typescript ts-loader
```

**Option B: CLI (Beta)**

```bash
npx @expozr/cli init expozr my-components
cd my-components
npm install
```

**expozr.config.ts:**

```typescript
import { defineExpozrConfig } from "@expozr/core";

export default defineExpozrConfig({
  name: "my-components",
  version: "1.0.0",
  expose: {
    "./Button": {
      entry: "./src/components/Button.tsx",
      exports: ["Button", "ButtonProps"],
    },
    "./Card": {
      entry: "./src/components/Card.tsx",
      exports: ["Card", "CardProps"],
    },
    "./utils": {
      entry: "./src/utils/index.ts",
      exports: ["add", "multiply"],
      dependencies: {
        lodash: "^4.17.21",
        // ...other dependencies
      },
    },
  },
  dependencies: {
    react: "^18.0.0",
    "react-dom": "^18.0.0",
    // ...other shared dependencies
  },
  build: {
    outDir: "dist",
    publicPath: "http://localhost:3001/",
  },
});
```

**webpack.config.js:**

```javascript
const { createExpozrPlugin } = require("@expozr/webpack-adapter");

module.exports = {
  plugins: [createExpozrPlugin()],
};
```

### 2. Create a Host (Consume Modules)

```bash
npx @expozr/cli init host my-app
cd my-app
npm install
```

**For React components, install React support:**

```bash
npm install @expozr/react react react-dom
```

**React Host app:**

```typescript
import React from "react";
import { loadReactExpozr } from "@expozr/react";

const expozr = loadReactExpozr("http://localhost:3001");

// Load React components dynamically
const Button = React.lazy(() =>
  expozr.then((mod) => ({ default: mod.Button }))
);

// Use them in your React app
function App() {
  return (
    <div>
      <Button onClick={() => console.log("Clicked!")}>
        Click me!
      </Button>
    </div>
  );
}
```

**Host Configuration (optional):**

```typescript
import { defineExpozrConfig } from "@expozr/core";

export default defineExpozrConfig({
  name: "my-host",
  version: "1.0.0",
  expose: {
    // Currently just a consumer, but ready to expose modules if needed
  },
  metadata: {
    description: "Host application that consumes remote components",
    author: "Your Name",
    license: "MIT",
  },
});
```

## üì¶ Installation

```bash
# Core packages
npm install @expozr/core @expozr/navigator @expozr/webpack-adapter

# React support
npm install @expozr/react

# CLI tools (beta)
npm install -g @expozr/cli
```

## üì¶ Packages

### Core Packages

- **[@expozr/core](./packages/core)** - Core abstractions, types, and configuration system with multi-format module support (ESM, UMD, CJS)
- **[@expozr/navigator](./packages/navigator)** - Universal runtime loader with smart format detection, caching strategies, and cross-platform support

### Bundler Adapters

- **[@expozr/webpack-adapter](./packages/adapters/webpack)** - Webpack 5+ support with inventory generation and hot reloading
- **[@expozr/vite-adapter](./packages/adapters/vite)** - Vite support with ESM-first approach and development server integration
- **[@expozr/rollup-adapter](./packages/adapters/rollup)** - Rollup support _(coming soon)_
- **[@expozr/rspack-adapter](./packages/adapters/rspack)** - Rspack support _(coming soon)_

### Framework Utilities

- **[@expozr/react](./packages/react)** - React component loading utilities

### Developer Tools

- **[@expozr/cli](./packages/cli)** - Command line tools

## üõ†Ô∏è Bundler Support

| Bundler    | Status     | Package                 |
| ---------- | ---------- | ----------------------- |
| Webpack 5+ | ‚úÖ Ready   | @expozr/webpack-adapter |
| Vite       | ‚úÖ Ready   | @expozr/vite-adapter    |
| Rollup     | üìã Planned | @expozr/rollup-adapter  |
| Rspack     | üìã Planned | @expozr/rspack-adapter  |
| Parcel     | üìã Planned | @expozr/parcel-adapter  |

## üîß Configuration

### Expozr Configuration

```typescript
export default defineExpozrConfig({
  name: "my-expozr",
  version: "1.0.0",
  expose: {
    "./Button": {
      entry: "./src/Button.tsx",
      exports: ["Button", "ButtonProps"],
      dependencies: {
        react: "^18.0.0",
      },
    },
  },
  metadata: {
    description: "My component library",
    author: "Your Name",
  },
});
```

### Host Configuration

```typescript
export default defineExpozrConfig({
  name: "my-host",
  version: "1.0.0",
  expose: {
    // Hosts can also expose modules if needed
  },
  metadata: {
    description: "Host application consuming remote components",
    author: "Your Name",
  },
});
```

### Advanced Configuration Examples

#### Multi-Format Module Support

```typescript
import { defineExpozrConfig, createHybridExpozrConfig } from "@expozr/core";

// Hybrid configuration supporting both ESM and UMD
export default createHybridExpozrConfig({
  name: "universal-components",
  entries: {
    "./Button": "./src/components/Button.tsx",
    "./Card": "./src/components/Card.tsx",
    "./utils": "./src/utils/index.ts",
  },
  build: {
    formats: ["esm", "umd"], // Build both formats
    globals: {
      react: "React",
      "react-dom": "ReactDOM",
    },
  },
});
```

#### Smart Caching Configuration

```typescript
import { createNavigator } from "@expozr/navigator";

const navigator = createNavigator({
  expozrs: {
    "ui-components": {
      url: "https://cdn.example.com/ui/",
      version: "^2.0.0",
    },
  },
  cache: {
    strategy: "indexedDB", // Persistent storage
    ttl: 86400000, // 24 hours
    maxSize: 100, // 100 modules max
  },
  loading: {
    timeout: 10000, // 10 seconds
    retries: 3, // Retry failed loads
    retryDelay: 1000, // 1 second between retries
  },
});

// Load with error handling
try {
  const cargo = await navigator.loadCargo("ui-components", "Button");
  console.log(`Loaded ${cargo.format} format using ${cargo.strategy} strategy`);
} catch (error) {
  console.error("Failed to load component:", error.message);
}
```

## üé® Examples & Quick Start

The fastest way to understand Expozr is to run the examples! We have working examples for different bundlers and frameworks.

### üìÇ Examples Directory

**‚û°Ô∏è [View all examples](./examples/)**

| Example                                                      | Description             | Stack                   |
| ------------------------------------------------------------ | ----------------------- | ----------------------- |
| [**Webpack + Get Started**](./examples/webpack/get-started/) | Simplest possible setup | TypeScript              |
| [**Webpack + Vanilla**](./examples/webpack/vanilla/)         | Basic module sharing    | Vanilla JS + TypeScript |
| [**Webpack + React**](./examples/webpack/react/)             | React component sharing | React + TypeScript      |
| [**Webpack + ESM**](./examples/webpack/esm/)                 | Modern ES modules       | ESM + TypeScript        |
| [**Webpack + UMD**](./examples/webpack/umd/)                 | Universal module format | UMD + TypeScript        |
| [**Vite + React**](./examples/vite/react/)                   | Vite React components   | Vite + React + TS       |

### ‚ö° Quick Start (2 minutes)

Try the simplest Get Started example:

```bash
# 1. Clone and setup
git clone https://github.com/brunos3d/expozr.git
cd expozr
npm install && npm run build

# 2. Start the expozr (port 3001)
cd examples/webpack/get-started/remote
npm install && npm run dev

# 3. In a new terminal, start the host (port 3000)
cd examples/webpack/get-started/host
npm install && npm run dev

# 4. Open http://localhost:3000 in your browser
```

**That's it!** You'll see the host loading and using utilities from the remote expozr in real-time.

### üéØ What You'll See

- ‚úÖ **Automatic Config Discovery**: Zero configuration needed
- ‚úÖ **Runtime Module Loading**: Modules loaded dynamically from remote
- ‚úÖ **Hot Reloading**: Changes update instantly in development
- ‚úÖ **Error Handling**: Clear error messages and troubleshooting

### üöÄ Try More Examples

**For Vite + React components:**

```bash
# Start Vite React expozr (port 5001)
cd examples/vite/react/remote && npm install && npm run dev

# Start Vite React host (port 5000) - new terminal
cd examples/vite/react/host && npm install && npm run dev
```

**For advanced Webpack examples:**

```bash
# Try the UMD Calculator example
cd examples/webpack/umd/remote && npm install && npm run dev
cd examples/webpack/umd/host && npm install && npm run dev
```

## üìö Framework Support

### ‚öõÔ∏è React

Expozr provides first-class React support with `@expozr/react`:

```typescript
import { loadReactExpozr, setupReactGlobals } from "@expozr/react";

// Load React expozr
const expozr = loadReactExpozr("http://localhost:3001");

// Use with React.lazy for automatic code splitting
const Button = React.lazy(() =>
  expozr.then((mod) => ({ default: mod.Button }))
);

// Or load directly
const { Button, Card } = await expozr;
```

**Features:**

- ‚úÖ **React.lazy Integration**: Seamless lazy loading with Suspense
- ‚úÖ **Hot Reloading**: Works with React dev server
- ‚úÖ **Hook Sharing**: Share custom React hooks between apps
- ‚úÖ **Automatic Globals**: Sets up React/ReactDOM globals for UMD modules

---

Check out the [examples](./examples) directory for complete working examples and detailed setup instructions.

## üåü Why Expozr?

- **Simpler**: No complex configuration or dependency management
- **Flexible**: Runtime discovery and loading
- **Lightweight**: No framework lock-in or routing complexity
- **Granular**: Share individual components, not entire applications
- **Efficient**: Smart caching and dependency resolution

### vs Package Registries

- **Dynamic**: Load modules at runtime, not build time
- **Versioned**: Multiple versions can coexist
- **Distributed**: No central registry required

## üó∫Ô∏è Roadmap

### Phase 1: Foundation ‚úÖ

- [x] Core library and types
- [x] Navigator runtime system
- [x] Webpack adapter
- [x] Vite adapter
- [x] React utilities
- [x] Working examples (Get Started, Vanilla, React, ESM, UMD, Vite)
- [x] Basic CLI tools (in beta)

### Phase 2: Expansion üöß

- [ ] Stable CLI with templates
- [ ] Rollup adapter
- [ ] Advanced CLI features
- [ ] More framework examples (Vue, Angular, Svelte)
- [ ] Documentation website

### Phase 3: Production üìã

- [ ] Performance optimizations
- [ ] Security features
- [ ] Monitoring tools
- [ ] Registry service
- [ ] VS Code extension

### Phase 4: Ecosystem üîÆ

- [ ] Plugin marketplace
- [ ] Community tools
- [ ] Enterprise features

## ü§ù Contributing

We welcome contributions! Please see our [Contributing Guide](./CONTRIBUTING.md) for details.

## üìÑ License

MIT ¬© [Bruno Silva](https://github.com/brunos3d)

---

<div align="center">
  <strong>üöÄ Built with ‚ù§Ô∏è for the developer community</strong>
</div>
